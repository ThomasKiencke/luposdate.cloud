-- TriplePattern: ?journal <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://localhost/vocabulary/bench/Journal> .
INTERMEDIATE_BAG_0 = load 'hbase://PO_S' using lupos.cloud.pig.udfs.HBaseLoadUDF('Hexa', '','<http://www.w3.org/1999/02/22-rdf-syntax-ns#type>,<http://localhost/vocabulary/bench/Journal>') as(triple:map[]);
bloom0i = load 'hbase://PO_S' using lupos.cloud.pig.udfs.HBaseLoadUDF('bloomfilter1', '','<http://www.w3.org/1999/02/22-rdf-syntax-ns#type>,<http://localhost/vocabulary/bench/Journal>') as( bloomfilter1:map[]);
bloom0 = foreach bloom0i generate lupos.cloud.pig.udfs.BloomfilterMapToByteArrayUDF($0);
INTERMEDIATE_BAG_0x = foreach INTERMEDIATE_BAG_0 generate flatten(lupos.cloud.pig.udfs.MapToBagUDF($0)); 
-- bloom0 = load 'hbase://PO_S' using lupos.cloud.pig.udfs.HBaseLoadBitvectorUDF('bloomfilter1', '','<http://www.w3.org/1999/02/22-rdf-syntax-ns#type>,<http://localhost/vocabulary/bench/Journal>') as(bloomfilter1:bytearray);


-- TriplePattern: ?journal <http://purl.org/dc/elements/1.1/title> "Journal 1 (1940)"^^<http://www.w3.org/2001/XMLSchema#string> .
INTERMEDIATE_BAG_1 = load 'hbase://PO_S' using lupos.cloud.pig.udfs.HBaseLoadUDF('Hexa', '','<http://purl.org/dc/elements/1.1/title>,"Journal 1 (1940)"^^<http://www.w3.org/2001/XMLSchema#string>') as(triple:map[]);
bloom1i = load 'hbase://PO_S' using lupos.cloud.pig.udfs.HBaseLoadUDF('bloomfilter1', '','<http://purl.org/dc/elements/1.1/title>,"Journal 1 (1940)"^^<http://www.w3.org/2001/XMLSchema#string>') as(bloomfilter1:map[]);
bloom1 = foreach bloom1i generate lupos.cloud.pig.udfs.BloomfilterMapToByteArrayUDF($0);
INTERMEDIATE_BAG_1x = foreach INTERMEDIATE_BAG_1 generate flatten(lupos.cloud.pig.udfs.MapToBagUDF($0)); 

-- TriplePattern: ?journal <http://purl.org/dc/terms/issued> ?yr .
INTERMEDIATE_BAG_2 = load 'hbase://P_SO' using lupos.cloud.pig.udfs.HBaseLoadUDF('Hexa', '','<http://purl.org/dc/terms/issued>') as(triple:map[], bloomfilter1:map[]); 
bloom2i = load 'hbase://P_SO' using lupos.cloud.pig.udfs.HBaseLoadUDF('bloomfilter1 bloomfilter2', '','<http://purl.org/dc/terms/issued>') as(bloomfilter1:map[], bloomfilter2:map[]); 
bloom2 = foreach bloom2i generate lupos.cloud.pig.udfs.BloomfilterMapToByteArrayUDF($0);
INTERMEDIATE_BAG_2x = foreach INTERMEDIATE_BAG_2 generate flatten(lupos.cloud.pig.udfs.MapToBagUDF($0)); 

-- Join over ?journal
INTERMEDIATE_BAG_0a = FILTER INTERMEDIATE_BAG_0x by lupos.cloud.pig.udfs.BloomfilterUDF(bloom1.$0, $0) AND  lupos.cloud.pig.udfs.BloomfilterUDF(bloom2.$0, $0);
INTERMEDIATE_BAG_1b = FILTER INTERMEDIATE_BAG_1x by lupos.cloud.pig.udfs.BloomfilterUDF(bloom0.$0, $0) AND  lupos.cloud.pig.udfs.BloomfilterUDF(bloom2.$0, $0);
INTERMEDIATE_BAG_2c = FILTER INTERMEDIATE_BAG_2x by lupos.cloud.pig.udfs.BloomfilterUDF(bloom0.$0, $0) AND  lupos.cloud.pig.udfs.BloomfilterUDF(bloom1.$0, $0);
INTERMEDIATE_BAG_3 = JOIN INTERMEDIATE_BAG_0a BY $0, INTERMEDIATE_BAG_1b BY $0, INTERMEDIATE_BAG_2c BY $0 PARALLEL 3;

-- Projection: ?yr
X = FOREACH INTERMEDIATE_BAG_3 GENERATE $3;
-- X = INTERMEDIATE_BAG_1b;
-- X = bloom0;